

{% extends "student_portal_base.html" %}

<style>
    .table td {
        line-height: 0 !important;
    }
</style>

{% block content %}

 <!-- Printable Header -->
    <div class="print-header text-center mb-4">
        {% if school_logo_url %}
            <img src="{{ school_logo_url }}" alt="School Logo" class="school-logo mb-2"
            style="width:50px;height:50px">
        {% endif %}
        <h3 class="school-name mb-1">{{ school_name }}</h3>
        <p class="school-address mb-0">{{ school_address }}</p>
        {% if school_website %}
            <p class="school-website mb-0">{{ school_website }}</p>
        {% endif %}
        <hr class="mt-3">
    </div>

<div class="container">
    <div class="row">

        <h2 class="text-center">Student Exam Results</h2>

        <!-- Exam Result Form -->
        <form method="GET" class="mb-4 no-print ">
            <div class="row">
                <div class="col-md-3 no-print">
                    <label>Academic Year:</label>
                    {{ form.academic_year }}
                </div>
                <div class="col-md-3 no-print">
                    <label>Exam Type:</label>
                    {{ form.exam }}
                </div>
                <div class="col-md-3">
                    <label>&nbsp;</label><br>
                    <button type="submit" class="btn btn-primary">Get Results</button>
                </div>
            </div>
        </form>

        {% if exam_results_grouped %}
        <div class="col-12">
            <!-- Student & Exam Details -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row">
                        <!-- Student Details -->
                        <div class="col-12 col-md-6 d-flex">
                            <div class="mx-3 mt-5">
                                {% if student.profile_picture %}
                                <img src="{{ student.profile_picture.url }}" alt="Student Profile" class="rounded-circle" width="100" height="100">
                                {% endif %}
                            </div>
                            <div>
                                <h5>Student Information</h5>
                                <p><strong>Name:</strong> {{ student.name }}<br>
                                <strong>Student ID:</strong> {{ student.student_id }}<br>
                                <strong>Class:</strong> {{ student.enrolled_students.first.academic_class.name }}<br>
                                <strong>Section:</strong> {{ student.enrolled_students.first.section.name }}<br>
                                <strong>Shift:</strong> {{ student.enrolled_students.first.student_class.shift }}</p>
                            </div>
                        </div>

                        <!-- Exam Details -->
                        <div class="col-md-6 d-flex flex-column align-items-end text-end">
                            <h5>Exam & Other Details</h5>
                            <p><strong>Exam Type:</strong>

				{% if selected_exam %}
				    {{ selected_exam.name }}
					{% else %}
    					All Exams
					{% endif %}<br>

                                <strong>Academic Year:</strong> {{ academic_year }}<br>
                                <strong>Version:</strong> {{ student.enrolled_students.first.student_class.language_version }}<br>
                                <strong>Gender:</strong> {{ student.enrolled_students.first.section.class_gender }}<br>
                                <strong>Class Teacher:</strong> {{ student.enrolled_students.first.section.teacher_in_charge }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <h3 class="text-center">Exam Results for {{ student.name }} â€” Academic Year: {{ academic_year }}</h3>

        <div class="col-12 table-responsive">
            <div class="container">
                <div class="row justify-content-between">
                    {% for exam_label, results in exam_results_grouped.items %}
                    <div class="col-12 mb-5">
                        <h4 class="mt-4">{{ exam_label }}</h4>
                        <table class="table table-bordered table-striped">
                            <thead class="table-info">
                                <tr>
                                    <th>Subject</th>
                                    <th>Obtained Marks</th>
                                    <th>Total Marks</th>
                                    <th>Highest Marks</th>
                                    <th>Percentage</th>
                                    <th>Total Students</th>
                                    <th>Subject Teacher</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for result in results %}
                                <tr>
                                    <td>{{ result.exam_type.subject.name }}</td>
                                    <td>{{ result.obtained_marks }}</td>
                                    <td>{{ result.exam_marks }}</td>
                                    <td>{{ result.max_obtained_marks }}</td>
                                    <td>{{ result.percentage|floatformat:2 }}%</td>
                                    <td>{{ result.total_student }}</td>
                                    <td>{{ result.subject_teacher }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        {% else %}
        <p>No results found for the selected criteria.</p>
        {% endif %}
    </div>


   <button type="button" class="btn btn-primary me-2" onclick="window.print()">
        <i class="bi bi-printer"></i> Print Invoice
    </button>
    <a href="" class="btn btn-secondary">Back to dashboard</a>
 </div>

{% endblock %}
