{% extends "base.html" %}
{% load custom_filters %}
{% block title %}Student Payments{% endblock %}

{% block content %}

{% include 'university_management/quick_access_link.html' %}
<div class="container mt-4">

<form method="get" class="my-4" id="student-filter-form">
    <select id="student-select" name="q" class="form-control">
        <option value="">Select a student...</option>
        {% for student in students %}
            <option value="{{ student.student_id }}"
                {% if request.GET.q == student.student_id %}selected{% endif %}>
                {{ student.name }} ({{ student.student_id }})
            </option>
        {% endfor %}
    </select>
    <button type="submit" class="btn btn-primary mt-2">Search</button>
</form>

    <h2>ðŸ“„ Student Payments</h2>   

    <div class="table-responsive">
        <table class="table table-bordered table-sm">
            <thead class="table-light">
                <tr>
                    <th>Student</th>
                    <th>Invoice Term</th>
                    <th>Amount Paid</th>
                    <th>Method</th>
                    <th>Transaction ID</th>
                    <th>Paid At</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for payment in payments %}
                <tr>
                    <td>{{ payment.invoice.student.name }}</td>
                    <td>{{ payment.invoice.term.name }}</td>
                    <td>{{ payment.total_paid|add_commas }}</td>
                    <td>{{ payment.payment_method|title }}</td>
                    <td>{{ payment.transaction_id }}</td>
                    <td>{{ payment.paid_at }}</td>
                    <td>
                         <a href="{% url 'university_management:make_payment' payment.invoice.id %}" class="btn btn-sm btn-primary mb-3">
                        Add New Payment
                    </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center">No payments recorded.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
$(document).ready(function () {

    $('#student-select').select2({
        placeholder: "Select a student",
        allowClear: true,
        width: '100%'
    });
 
    $('#student-select').on('select2:select', function () {
        $('#student-filter-form').submit();
    });

});
</script>


{% endblock %}
